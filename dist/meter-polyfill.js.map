{"version":3,"sources":["meter-polyfill.js"],"names":["root","factory","define","amd","module","exports","meterPolyfill","this","window","each","arrLike","fn","i","len","length","on","el","events","listener","useCapture","split","event","support","addEventListener","attachEvent","hasAttribute","name","getAttribute","isMeter","tagName","toUpperCase","METER_TAGNAME","fixValue","meter","props","METER_PROPS","prop","PROP_MAX","PROP_LOW","PROP_HIGH","PROP_VALUE","PROP_OPTIMUN","removeAttribute","calcLevel","min","PROP_MIN","max","low","high","optimum","value","percentage","level","LEVEL_OPTIMUN","LEVEL_SUBOPTIMUN","LEVEL_SUBSUBOPTIMUN","createShadow","native","innerHTML","METER_SHADOW_HTML","setAttribute","updateMeterStyle","setMeterAttribute","attr","Math","pollyfillGetterSetter","getSetter","toLowerCase","getGetter","METER_INITAL_VALUES","isGetterSetterPolyfilled","unknownElement","prototype","meterElement","constructor","syncAttribute","set","get","Object","defineProperty","innerDivs","getElementsByTagName","valueElement","className","METER_VALUE_CLASSES","style","width","observer","isObservered","MutationObserver","mutations","mutation","polyfill","target","observe","documentElement","attributes","attributeFilter","subtree","childList","e","context","meters","autoPolyfill","document","readyState","isTop","frameElement","_","doScroll","external","setTimeout","METER_CLASS_PREFIX","inner","bar","WebKitMutationObserver","createElement","join","CLASSES","INITAL_VALUES","fix","calc"],"mappings":";;;;;;;CACA,SAAUA,EAAMC,GACd,YACsB,mBAAXC,SAAyBA,OAAOC,IAEzCD,UAAW,WACT,MAAOD,GAAQD,KAEU,gBAAXI,SAAuBA,OAAOC,QAC9CD,OAAOC,QAAUJ,EAAQD,GAEzBA,EAAKM,cAAgBL,EAAQD,IAE9BO,KAAM,SAASC,GAChB,YA+DA,SAASC,GAAKC,EAASC,GACrB,IAAK,GAAIC,GAAI,EAAGC,EAAMH,EAAQI,OAAQF,EAAIC,EAAKD,IAC7CD,EAAGD,EAAQE,GAAIA,GAInB,QAASG,GAAGC,EAAIC,EAAQC,EAAUC,GAEhCV,EAAKQ,EAAOG,MAAM,KAAM,SAASC,GAC3BC,EAAQC,iBACVP,EAAGO,iBAAiBF,EAAOH,EAAUC,GAC5BG,EAAQE,YACjBR,EAAGQ,YAAY,KAAOH,EAAOH,GAE7BF,EAAG,KAAOK,GAASH,IAKzB,QAASO,GAAaT,EAAIU,GACxB,MAAIJ,GAAQG,aACHT,EAAGS,aAAaC,GAEU,OAA1BV,EAAGW,aAAaD,GAI3B,QAASE,GAAQZ,GACf,MAAOA,IAAMA,EAAGa,SAAWb,EAAGa,QAAQC,gBAAkBC,EAG1D,QAASC,GAASC,EAAOC,GAgDvB,MA/CAzB,GAAKyB,GAASC,EAAa,SAASC,GAClC,OAAQA,GACN,IAAKC,GACCJ,EAAMI,GAAYJ,EAAMI,KAC1BJ,EAAMI,GAAYJ,EAAMI,GAE1B,MACF,KAAKC,GACCL,EAAMK,GAAYL,EAAMI,KAC1BJ,EAAMK,GAAYL,EAAMI,GAE1B,MACF,KAAKE,GACCN,EAAMM,GAAaN,EAAMI,KAC3BJ,EAAMM,GAAaN,EAAMI,IAEvBJ,EAAMM,GAAaN,EAAMK,KAC3BL,EAAMM,GAAaN,EAAMK,GAE3B,MACF,KAAKE,IAEAP,EAAMO,GAAcP,EAAMI,IACG,mBAAtBJ,GAAMO,MAEdP,EAAMO,GAAcP,EAAMI,IAExBJ,EAAMO,GAAcP,EAAMI,KAC5BJ,EAAMO,GAAcP,EAAMI,GAE5B,MACF,KAAKI,IAEAR,EAAMQ,GAAgBR,EAAMI,IAAaJ,EAAMQ,GAAgBR,EAAMI,IACtC,mBAAxBJ,GAAMQ,MAEVb,EAAQK,IAAUR,EAAaQ,EAAOQ,GACxCR,EAAMS,gBAAgBD,GAEtBR,EAAMQ,GAAgBR,EAAMI,IAAaJ,EAAMI,GAAYJ,EAAMI,IAAa,MAQjFJ,EAGT,QAASU,GAAUT,GACjB,GAAIU,GAAMV,EAAMW,GACZC,EAAMZ,EAAMG,GACZU,EAAMb,EAAMI,GACZU,EAAOd,EAAMK,GACbU,EAAUf,EAAMO,GAChBS,EAAQhB,EAAMM,GAEdW,EAAaP,IAAQE,EAAM,GAAKI,EAAQN,IAAQE,EAAMF,GAAO,IAC7DQ,EAAQC,CA2CZ,OAxCEL,KAASF,GACTC,IAAQH,GACPK,GAAWF,GAAOE,GAAWD,GAG3BD,GAAOE,GAAWC,EAAQH,GAC1BA,EAAME,GAAWC,EAAQH,GACzBC,EAAOC,GAAWC,EAAQF,GAC1BA,GAAQC,GAAWC,EAAQF,KAE5BI,EAAQE,GAEDP,IAAQC,GAEdD,GAAOE,GAAWC,EAAQH,GAC1BC,EAAOC,GAAWC,EAAQF,KAE3BI,EAAQG,GAKDN,EAAUF,EACfG,EAAQH,GAAOG,GAASF,EAC1BI,EAAQE,EACCJ,EAAQF,IACjBI,EAAQG,GAEDN,EAAUD,IACfE,GAASH,GAAOG,EAAQF,EAC1BI,EAAQE,EACCJ,EAAQH,IACjBK,EAAQG,KASVJ,WAAYA,EACZC,MAAOA,GAIX,QAASI,GAAavB,GACpB,MAAIX,GAAQmC,SAAW7B,EAAQK,IAAUR,EAAaQ,EAAO,aACpDA,GAGTA,EAAMyB,UAAYC,EAClB1B,EAAM2B,aAAa,YAAa,IAChC5B,EAASC,GACT4B,EAAiB5B,GACVA,GAGT,QAAS6B,GAAkB7B,EAAO8B,EAAMb,GACtC,OAAQa,GACN,IAAKlB,GACHZ,EAAM2B,aAAaG,EAAMb,GACzBlB,EAASC,GAAQI,EAAUC,EAAUC,EAAWC,EAAYC,GAC5D,MACF,KAAKJ,GACHa,EAAQc,KAAKlB,IAAII,EAAOjB,EAAMI,IAC9BJ,EAAM2B,aAAaG,EAAMb,GACzBlB,EAASC,GAAQK,EAAUC,EAAWC,EAAYC,GAClD,MACF,KAAKH,GACHY,EAAQc,KAAKpB,IAAIoB,KAAKlB,IAAII,EAAOjB,EAAMI,IAAYJ,EAAMI,IACzDJ,EAAM2B,aAAaG,EAAMb,GACzBlB,EAASC,GAAQM,GACjB,MACF,KAAKA,GACHW,EAAQc,KAAKpB,IAAIoB,KAAKlB,IAAII,EAAOjB,EAAMI,GAAWJ,EAAMK,IAAYL,EAAMI,IAC1EJ,EAAM2B,aAAaG,EAAMb,EACzB,MACF,KAAKT,GACHS,EAAQc,KAAKpB,IAAIoB,KAAKlB,IAAII,EAAOjB,EAAMI,IAAYJ,EAAMI,IACzDJ,EAAM2B,aAAaG,EAAMb,EACzB,MACF,SACEjB,EAAM2B,aAAaG,EAAMb,GAE7BW,EAAiBtD,MAGnB,QAAS0D,KAMP,QAASC,GAAU9B,GACjB,MAAO,UAASc,GACd,MAAItB,GAAQrB,UACVuD,GAAkBvD,KAAM6B,EAAK+B,eAAgBjB,GAEtC3C,KAAK6B,GAAQc,GAK1B,QAASkB,GAAUhC,GACjB,MAAO,YACL,MAAIR,GAAQrB,MACNkB,EAAalB,KAAM6B,IACb7B,KAAKoB,aAAaS,GACjBA,IAASE,EACX/B,KAAKqC,IACHR,IAASG,EACXhC,KAAKuC,IACHV,IAASK,GACVlC,KAAKuC,IAAMvC,KAAKqC,KAAO,EAAIrC,KAAKqC,IAC/BR,IAASI,EACXjC,KAAKqC,IAEPyB,EAAoBjC,GAEpB7B,KAAK6B,IA/BlB,IAAIkC,GAA6BhD,EAAQiD,eAAzC,CAIA,GAAIC,GAAYC,EAAaC,YAAYF,SAgCzC/D,GAAK0B,EAAa,SAASC,GACzB,GAAIF,KACCZ,GAAQqD,gBACXzC,EAAM0C,IAAMV,EAAU9B,IAExBF,EAAM2C,IAAMT,EAAUhC,GACtB0C,OAAOC,eAAeP,EAAWpC,EAAMF,KAGzCoC,GAA2B,GAG7B,QAAST,GAAiB5B,GACxB,IAAIX,EAAQmC,QAAW7B,EAAQK,GAA/B,CAIA,GAAI+C,GAAY/C,EAAMgD,qBAAqB,MAC3C,KAAKD,EAAUlE,OAEb,MADA0C,GAAavB,GACN4B,EAAiB5B,EAE1B,IAAIiD,GAAeF,EAAU,GAEzB9C,IACJzB,GAAK0B,EAAa,SAASC,GACrBd,EAAQiD,eACVrC,EAAME,IAASH,EAAMG,GACZX,EAAaQ,EAAOG,GAC7BF,EAAME,IAASH,EAAMN,aAAaS,GAElCF,EAAME,GAAQiC,EAAoBjC,KAKlCd,EAAQqD,gBACVzC,EAAQF,EAASE,GAGnB,IAAIkB,GAAQT,EAAUT,EACtBgD,GAAaC,UAAYC,EAAoBhC,EAAMA,OACnD8B,EAAaG,MAAMC,MAAQlC,EAAMD,WAAa,KAGhD,QAASoC,KACP,IAAIC,EAAJ,CAGA,GAAIlE,EAAQmE,iBAAkB,CAC5B,GAAIF,GAAW,GAAIE,GAAiB,SAASC,GAC3CjF,EAAKiF,EAAW,SAASC,GACvBC,EAASD,EAASE,WAGtBN,GAASO,QAAQC,GACfC,YAAY,EACZC,gBAAiB9D,EACjB+D,SAAS,EACTC,WAAW,QAGbpF,GAAGgF,EAAiB,kCAAmC,SAASK,GAC9DR,EAASQ,EAAEP,SAGfL,IAAe,GAGjB,QAASI,GAASS,GACZ/E,EAAQmC,MAIZ,IAAI6C,KAEFA,GADE1E,EAAQyE,IACAA,IAEAA,GAAWN,GAAiBd,qBAAqB,SAG7DhB,IACAxD,EAAK6F,EAAQ,SAASrE,GACpBuB,EAAavB,GACb4B,EAAiB5B,KAGnBsD,IAGF,QAASgB,KACqB,aAAxBC,EAASC,YACXb,IAEF7E,EAAGyF,EAAU,mBAAoB,WAC/BZ,KAGF,IAAIc,IAAQ,CACZ,KACEA,EAAgC,OAAxBlG,EAAOmG,aACf,MAAOC,IAELb,EAAgBc,UAAYH,GAASlG,EAAOsG,WAC9C,QAAUD,KACR,IACEd,EAAgBc,SAAS,QACzB,MAAOD,GACPpG,EAAOuG,WAAWF,EAAU,IAE9BjB,OAIJ7E,EAAGP,EAAQ,OAAQ,WACjBoF,MA3YJ,GAAItC,GAAmB,EACnBD,EAAgB,EAChBE,EAAsB,EACtBV,EAAW,MACXR,EAAW,MACXC,EAAW,MACXC,EAAY,OACZC,EAAa,QACbC,EAAe,UACfN,GAAeU,EAAUR,EAAUC,EAAUC,EAAWC,EAAYC,GACpEV,EAAgB,QAChBiF,EAAqB,SAErB5B,GACF6B,MAAOD,EAAqB,gBAC5BE,IAAKF,EAAqB,MAG5B5B,GAAoB/B,GAAiB2D,EAAqB,gBAC1D5B,EAAoB9B,GAAoB0D,EAAqB,mBAC7D5B,EAAoB7B,GAAuByD,EAAqB,sBAEhE,IAAIR,GAAWhG,EAAOgG,SAClBT,EAAkBS,EAAST,gBAE3BN,EAAmBjF,EAAOiF,kBAAoBjF,EAAO2G,uBACrD7C,GAA2B,EAC3BkB,GAAe,EAEff,EAAe+B,EAASY,cAAcrF,EAC1C0C,GAAa1B,IAAM,IACnB0B,EAAab,aAAarB,EAAW,IAErC,IAAIjB,IACFmC,OAAmC,IAA3BgB,EAAapC,GACrBoD,iBAA8C,mBAArBA,GACzBlE,mBAAoBf,EAAOe,iBAC3BC,cAAehB,EAAOgB,YACtBmD,cAAuD,MAAxCF,EAAa9C,aAAaW,IAAiD,MAA5BmC,EAAalC,GAC3EgC,iBAAkBE,EAAaC,YAC/BjD,eAAgBgD,EAAahD,cAG3B4C,GACFzB,IAAK,EACLE,IAAK,EACLC,IAAK,EACLC,KAAM,GAIJW,GACF,eAAiByB,EAAoB6B,MAAQ,KAC3C,eAAiB7B,EAAoB8B,IAAM,KACzC,eAAiB9B,EAAoB9B,GAAoB,sBACzD,SACF,SACF,UACA+D,KAAK,GAuVP,OAFAd,MAGEe,QAASlC,EACTmC,cAAelD,EACff,iBAAkBA,EAClBD,cAAeA,EACfE,oBAAqBA,EACrBqC,SAAUA,EACV4B,IAAKxF,EACLyF,KAAM9E","file":"meter-polyfill.js","sourcesContent":["/* globals define: true, module: true*/\n(function(root, factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], function() {\n      return factory(root);\n    });\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(root);\n  } else {\n    root.meterPolyfill = factory(root);\n  }\n})(this, function(window) {\n  'use strict';\n\n  var LEVEL_SUBOPTIMUN = 0;\n  var LEVEL_OPTIMUN = 1;\n  var LEVEL_SUBSUBOPTIMUN = 2;\n  var PROP_MIN = 'min';\n  var PROP_MAX = 'max';\n  var PROP_LOW = 'low';\n  var PROP_HIGH = 'high';\n  var PROP_VALUE = 'value';\n  var PROP_OPTIMUN = 'optimum';\n  var METER_PROPS = [PROP_MIN, PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUN];\n  var METER_TAGNAME = 'METER';\n  var METER_CLASS_PREFIX = 'meter-';\n\n  var METER_VALUE_CLASSES = {\n    inner: METER_CLASS_PREFIX + 'inner-element',\n    bar: METER_CLASS_PREFIX + 'bar'\n  };\n\n  METER_VALUE_CLASSES[LEVEL_OPTIMUN] = METER_CLASS_PREFIX + 'optimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBOPTIMUN] = METER_CLASS_PREFIX + 'suboptimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBSUBOPTIMUN] = METER_CLASS_PREFIX + 'even-less-good-value';\n\n  var document = window.document;\n  var documentElement = document.documentElement;\n  // there is no moz/ms/o vendor prefix\n  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n  var isGetterSetterPolyfilled = false;\n  var isObservered = false;\n\n  var meterElement = document.createElement(METER_TAGNAME);\n  meterElement.low = '1';\n  meterElement.setAttribute(PROP_HIGH, '1');\n\n  var support = {\n    native: meterElement[PROP_MAX] === 1,\n    MutationObserver: typeof MutationObserver !== 'undefined',\n    addEventListener: !!window.addEventListener,\n    attachEvent: !!window.attachEvent,\n    syncAttribute: meterElement.getAttribute(PROP_LOW) === '1' && meterElement[PROP_HIGH] === '1',\n    unknownElement: !!meterElement.constructor,\n    hasAttribute: !!meterElement.hasAttribute\n  };\n\n  var METER_INITAL_VALUES = {\n    min: 0,\n    max: 1,\n    low: 0,\n    high: 1\n  };\n\n\n  var METER_SHADOW_HTML = [\n    '<div class=\"' + METER_VALUE_CLASSES.inner + '\">',\n      '<div class=\"' + METER_VALUE_CLASSES.bar + '\">',\n        '<div class=\"' + METER_VALUE_CLASSES[LEVEL_SUBOPTIMUN] + '\" style=\"width: 0\">',\n        '</div>',\n      '</div>',\n    '</div>'\n  ].join('');\n\n  // help functions\n  function each(arrLike, fn) {\n    for (var i = 0, len = arrLike.length; i < len; i++) {\n      fn(arrLike[i], i);\n    }\n  }\n\n  function on(el, events, listener, useCapture) {\n    var agrs = arguments;\n    each(events.split(' '), function(event) {\n      if (support.addEventListener) {\n        el.addEventListener(event, listener, useCapture);\n      } else if (support.attachEvent) {\n        el.attachEvent('on' + event, listener);\n      } else {\n        el['on' + event] = listener;\n      }\n    });\n  }\n\n  function hasAttribute(el, name) {\n    if (support.hasAttribute) {\n      return el.hasAttribute(name);\n    } else {\n      return el.getAttribute(name) !== null;\n    }\n  }\n\n  function isMeter(el) {\n    return el && el.tagName && el.tagName.toUpperCase() === METER_TAGNAME;\n  }\n\n  function fixValue(meter, props) {\n    each(props || METER_PROPS, function(prop) {\n      switch (prop) {\n        case PROP_MAX:\n          if (meter[PROP_MAX] < meter[PROP_MAX]) {\n            meter[PROP_MAX] = meter[PROP_MAX];\n          }\n          break;\n        case PROP_LOW:\n          if (meter[PROP_LOW] < meter[PROP_MAX]) {\n            meter[PROP_LOW] = meter[PROP_MAX];\n          }\n          break;\n        case PROP_HIGH:\n          if (meter[PROP_HIGH] > meter[PROP_MAX]) {\n            meter[PROP_HIGH] = meter[PROP_MAX];\n          }\n          if (meter[PROP_HIGH] < meter[PROP_LOW]) {\n            meter[PROP_HIGH] = meter[PROP_LOW];\n          }\n          break;\n        case PROP_VALUE:\n          if (\n            (meter[PROP_VALUE] < meter[PROP_MAX]) ||\n            (typeof meter[PROP_VALUE] === 'undefined')\n          ) {\n            meter[PROP_VALUE] = meter[PROP_MAX];\n          }\n          if (meter[PROP_VALUE] > meter[PROP_MAX]) {\n            meter[PROP_VALUE] = meter[PROP_MAX];\n          }\n          break;\n        case PROP_OPTIMUN:\n          if (\n            (meter[PROP_OPTIMUN] < meter[PROP_MAX] || meter[PROP_OPTIMUN] > meter[PROP_MAX]) ||\n            (typeof meter[PROP_OPTIMUN] === 'undefined')\n          ) {\n            if (isMeter(meter) && hasAttribute(meter, PROP_OPTIMUN)) {\n              meter.removeAttribute(PROP_OPTIMUN);\n            } else {\n              meter[PROP_OPTIMUN] = meter[PROP_MAX] + (meter[PROP_MAX] - meter[PROP_MAX]) / 2;\n            }\n          }\n          break;\n        default:\n          break;\n      }\n    });\n    return meter;\n  }\n\n  function calcLevel(props) {\n    var min = props[PROP_MIN];\n    var max = props[PROP_MAX];\n    var low = props[PROP_LOW];\n    var high = props[PROP_HIGH];\n    var optimum = props[PROP_OPTIMUN];\n    var value = props[PROP_VALUE];\n\n    var percentage = min === max ? 0 : (value - min) / (max - min) * 100;\n    var level = LEVEL_OPTIMUN;\n\n    if (\n      high === max ||\n      low === min ||\n      (optimum >= low && optimum <= high)\n    ) {\n      if (\n        (low <= optimum && value < low) ||\n        (low > optimum && value > low) ||\n        (high < optimum && value < high) ||\n        (high >= optimum && value > high)\n      ) {\n        level = LEVEL_SUBOPTIMUN;\n      }\n    } else if (low === high) {\n      if (\n        (low <= optimum && value < low) ||\n        (high > optimum && value > high)\n      ) {\n        level = LEVEL_SUBSUBOPTIMUN;\n      }\n\n      // firefox show diffently from chrome when\n      // value === high\n    } else if (optimum < low) {\n      if (value > low && value <= high) {\n        level = LEVEL_SUBOPTIMUN;\n      } else if (value > high) {\n        level = LEVEL_SUBSUBOPTIMUN;\n      }\n    } else if (optimum > high) {\n      if (value >= low && value < high) {\n        level = LEVEL_SUBOPTIMUN;\n      } else if (value < low) {\n        level = LEVEL_SUBSUBOPTIMUN;\n      }\n\n      // firefox show diffently from chrome when\n      // value === high\n    }\n\n\n    return {\n      percentage: percentage,\n      level: level\n    };\n  }\n\n  function createShadow(meter) {\n    if (support.native || !isMeter(meter) || hasAttribute(meter, '_polyfill')) {\n      return meter;\n    }\n\n    meter.innerHTML = METER_SHADOW_HTML;\n    meter.setAttribute('_polyfill', '');\n    fixValue(meter);\n    updateMeterStyle(meter);\n    return meter;\n  }\n\n  function setMeterAttribute(meter, attr, value) {\n    switch (attr) {\n      case PROP_MIN:\n        meter.setAttribute(attr, value);\n        fixValue(meter, [PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUN]);\n        break;\n      case PROP_MAX:\n        value = Math.max(value, meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        fixValue(meter, [PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUN]);\n        break;\n      case PROP_LOW:\n        value = Math.min(Math.max(value, meter[PROP_MAX]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        fixValue(meter, [PROP_HIGH]);\n        break;\n      case PROP_HIGH:\n        value = Math.min(Math.max(value, meter[PROP_MAX], meter[PROP_LOW]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        break;\n      case PROP_OPTIMUN:\n        value = Math.min(Math.max(value, meter[PROP_MAX]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        break;\n      default:\n        meter.setAttribute(attr, value);\n    }\n    updateMeterStyle(this);\n  }\n\n  function pollyfillGetterSetter() {\n    if (isGetterSetterPolyfilled || !support.unknownElement) {\n      return;\n    }\n\n    var prototype = meterElement.constructor.prototype;\n    function getSetter(prop) {\n      return function(value) {\n        if (isMeter(this)) {\n          setMeterAttribute(this, prop.toLowerCase(), +value);\n        } else {\n          return this[prop] = value;\n        }\n      };\n    }\n\n    function getGetter(prop) {\n      return function() {\n        if (isMeter(this)) {\n          if (hasAttribute(this, prop)) {\n            return +this.getAttribute(prop);\n          } else if (prop === PROP_LOW) {\n            return this.min;\n          } else if (prop === PROP_HIGH) {\n            return this.max;\n          } else if (prop === PROP_OPTIMUN) {\n            return (this.max - this.min) / 2 + this.min;\n          } else if (prop === PROP_VALUE) {\n            return this.min;\n          }\n          return METER_INITAL_VALUES[prop];\n        } else {\n          return this[prop];\n        }\n      };\n    }\n\n    each(METER_PROPS, function(prop) {\n      var props = {};\n      if (!support.syncAttribute) {\n        props.set = getSetter(prop);\n      }\n      props.get = getGetter(prop);\n      Object.defineProperty(prototype, prop, props);\n    });\n\n    isGetterSetterPolyfilled = true;\n  }\n\n  function updateMeterStyle(meter) {\n    if (support.native || !isMeter(meter)) {\n      return;\n    }\n\n    var innerDivs = meter.getElementsByTagName('div');\n    if (!innerDivs.length) {\n      createShadow(meter);\n      return updateMeterStyle(meter);\n    }\n    var valueElement = innerDivs[2];\n\n    var props = {};\n    each(METER_PROPS, function(prop) {\n      if (support.unknownElement) {\n        props[prop] = +meter[prop];\n      } else if (hasAttribute(meter, prop)) {\n        props[prop] = +meter.getAttribute(prop);\n      } else {\n        props[prop] = METER_INITAL_VALUES[prop];\n      }\n    });\n\n    // ie8 return no fixed props\n    if (support.syncAttribute) {\n      props = fixValue(props);\n    }\n\n    var level = calcLevel(props);\n    valueElement.className = METER_VALUE_CLASSES[level.level];\n    valueElement.style.width = level.percentage + '%';\n  }\n\n  function observer() {\n    if (isObservered) {\n      return;\n    }\n    if (support.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          polyfill(mutation.target);\n        });\n      });\n      observer.observe(documentElement, {\n        attributes: true,\n        attributeFilter: METER_PROPS,\n        subtree: true,\n        childList: true\n      });\n    } else {\n      on(documentElement, 'DOMNodeInserted DOMAttrModified', function(e) {\n        polyfill(e.target);\n      });\n    }\n    isObservered = true;\n  }\n\n  function polyfill(context) {\n    if (support.native) {\n      // return;\n    }\n\n    var meters = [];\n    if (isMeter(context)) {\n      meters = [context];\n    } else {\n      meters = (context || documentElement).getElementsByTagName('meter');\n    }\n\n    pollyfillGetterSetter();\n    each(meters, function(meter) {\n      createShadow(meter);\n      updateMeterStyle(meter);\n    });\n\n    observer();\n  }\n\n  function autoPolyfill() {\n    if (document.readyState === 'complete') {\n      polyfill();\n    }\n    on(document, 'DOMContentLoaded', function() {\n      polyfill();\n    });\n\n    var isTop = false;\n    try {\n      isTop = window.frameElement === null;\n    } catch (_) {}\n\n    if (documentElement.doScroll && isTop && window.external) {\n      (function doScroll() {\n        try {\n          documentElement.doScroll('left');\n        } catch (_) {\n          window.setTimeout(doScroll, 50);\n        }\n        polyfill();\n      })();\n    }\n\n    on(window, 'load', function() {\n      polyfill();\n    });\n  }\n\n  autoPolyfill();\n\n  return {\n    CLASSES: METER_VALUE_CLASSES,\n    INITAL_VALUES: METER_INITAL_VALUES,\n    LEVEL_SUBOPTIMUN: LEVEL_SUBOPTIMUN,\n    LEVEL_OPTIMUN: LEVEL_OPTIMUN,\n    LEVEL_SUBSUBOPTIMUN: LEVEL_SUBSUBOPTIMUN,\n    polyfill: polyfill,\n    fix: fixValue,\n    calc: calcLevel\n  };\n\n});\n"]}