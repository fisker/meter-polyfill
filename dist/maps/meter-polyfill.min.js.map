{"version":3,"sources":["meter-polyfill.min.js"],"names":["root","factory","define","amd","module","exports","meterPolyfill","this","window","isMeter","el","tagName","toUpperCase","METER_TAG","each","arrLike","fn","i","len","length","isUndefined","obj","isVoidValue","floatValue","parseFloat","isNaN","isFinite","getPropValue","meter","prop","value","isNull","min","max","low","PROP_MIN","METER_INITAL_VALUES","PROP_MAX","mathMax","PROP_LOW","mathMin","PROP_HIGH","PROP_OPTIMUM","PROP_VALUE","fixProps","propValues","METER_PROPS","calcLevel","high","optimum","percentage","level","LEVEL_OPTIMUM","LEVEL_SUBOPTIMUM","LEVEL_SUBSUBOPTIMUM","isFirefox","className","METER_VALUE_CLASSES","createNativeFunction","fnName","toString","nativeToString","bind","call","on","events","listener","useCapture","split","event","supports","addEventListener","attachEvent","hasAttribute","name","getAttribute","updateMeterStyle","valueElement","getElementsByTagName","style","width","_","documentCreateElemennt","createElement","apply","document","arguments","polyfill","observerSubtree","isObservered","MutationObserver","observer","mutations","mutation","target","observe","documentElement","subtree","childList","DOMNodeInserted","e","context","meters","setAttribute","constructor","HTMLMeterElement","createShadowDom","defineEtter","observerAttr","attributes","attributeFilter","DOMAttrModified","join","indexOf","attrName","propertychange","propertyName","srcElement","canHaveChildren","canHaveHTML","parent","parentNode","meterClone","replaceChild","innerHTML","METER_SHADOW_HTML","slashMeters","slashMeter","removeChild","getGetter","getSetter","TypeError","HTML_METER_ELEMENT_CONSTRICTOR_NAME","METHOD_SET_ATTRIBUTE","METHOD_CLONE_NODE","cloneNode","etters","get","attersAsProps","set","defineProperty","attributeSetter","attr","toLowerCase","cloneNodeMethd","deep","clone","removeAttribute","NOOP","METER_CLASS_PREFIX","inner","bar","METHOD_CREATE_ELEMENT","navigator","userAgent","meterElement","nativeSupport","CLASSES","calc","Object","o","property","enumerable","configurable","number","__defineGetter__","__defineSetter__","Function","prototype","oThis","args","Array","slice","fnToBind","fnBound","concat","replace","$1","$2","HTMLElement","Element","Node","create","WebKitMutationObserver","isReady","unknownElement","supportsDOMNodeInserted","supportsDOMAttrModified","testDiv","testChild","appendChild","Math","setTimeout","checkReady","completed","readyState","isTop","frameElement","doScroll","polyfillWhenReady"],"mappings":"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","file":"../meter-polyfill.min.js","sourcesContent":["/* globals define: true, module: true*/\n(function(root, factory) {\n  'use strict';\n\n  if (typeof define === 'function' && define.amd) {\n    define(factory(root));\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(root);\n  } else {\n    root.meterPolyfill = factory(root);\n  }\n})(this, function(window) {\n  'use strict';\n\n  var METER_TAG = '<%= METER_TAG %>';\n\n  var NOOP = function() {};\n\n  var LEVEL_OPTIMUM = 1;\n  var LEVEL_SUBOPTIMUM = 2;\n  var LEVEL_SUBSUBOPTIMUM = 3;\n  var METER_CLASS_PREFIX = 'meter-';\n\n  var METER_VALUE_CLASSES = {\n    inner: METER_CLASS_PREFIX + 'inner-element',\n    bar: METER_CLASS_PREFIX + 'bar'\n  };\n\n  METER_VALUE_CLASSES[LEVEL_OPTIMUM] = METER_CLASS_PREFIX + 'optimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBOPTIMUM] = METER_CLASS_PREFIX + 'suboptimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBSUBOPTIMUM] = METER_CLASS_PREFIX + 'even-less-good-value';\n\n  var PROP_MIN = 'min';\n  var PROP_MAX = 'max';\n  var PROP_LOW = 'low';\n  var PROP_HIGH = 'high';\n  var PROP_VALUE = 'value';\n  var PROP_OPTIMUM = 'optimum';\n\n  var METER_PROPS = [PROP_MIN, PROP_MAX, PROP_LOW, PROP_HIGH, PROP_OPTIMUM, PROP_VALUE];\n\n  var METHOD_CREATE_ELEMENT = 'createElement';\n\n  var METER_INITAL_VALUES = {\n    min: 0,\n    max: 1\n  };\n\n  // TODO:\n  // use getComputedStyle find the right calculator\n  var isFirefox = window.navigator.userAgent.indexOf('Firefox') > -1;\n\n  var document = window.document;\n\n  var meterElement = document[METHOD_CREATE_ELEMENT](METER_TAG);\n  var nativeSupport = meterElement[PROP_MAX] === METER_INITAL_VALUES[PROP_MAX];\n\n  function isMeter(el) {\n    return el && el.tagName && el.tagName.toUpperCase() === METER_TAG;\n  }\n\n  function each(arrLike, fn) {\n    var i = 0;\n    var len = arrLike.length;\n    for (; i < len; i++) {\n      fn(arrLike[i], i);\n    }\n  }\n\n  function isUndefined(obj) {\n    return typeof obj === 'undefined';\n  }\n\n  function isVoidValue(obj) {\n    var floatValue = parseFloat(obj);\n    return isUndefined(obj) || isNaN(floatValue) || !isFinite(floatValue);\n  }\n\n  function getPropValue(meter, prop) {\n    var value = meter[prop];\n    var isNull = value === null;\n    var min;\n    var max;\n    var low;\n    value = parseFloat(value);\n    switch (prop) {\n      case PROP_MIN:\n        value = isNull ?\n          METER_INITAL_VALUES[PROP_MIN] :\n          value;\n        break;\n      case PROP_MAX:\n        min = getPropValue(meter, PROP_MIN);\n        value = isNull ?\n          mathMax(min, METER_INITAL_VALUES[PROP_MAX]) :\n          mathMax(min, value);\n        break;\n      case PROP_LOW:\n        min = getPropValue(meter, PROP_MIN);\n        max = getPropValue(meter, PROP_MAX);\n        value = isNull ?\n          min :\n          mathMin(mathMax(min, value), max);\n        break;\n      case PROP_HIGH:\n        max = getPropValue(meter, PROP_MAX);\n        low = getPropValue(meter, PROP_LOW);\n        value = isNull ?\n          max :\n          mathMin(mathMax(low, value), max);\n        break;\n      case PROP_OPTIMUM:\n        min = getPropValue(meter, PROP_MIN);\n        max = getPropValue(meter, PROP_MAX);\n        value = isNull ?\n          (max - min) / 2 + min :\n          mathMin(mathMax(min, value), max);\n        break;\n      case PROP_VALUE:\n        min = getPropValue(meter, PROP_MIN);\n        max = getPropValue(meter, PROP_MAX);\n        value = isNull ?\n          min :\n          mathMin(mathMax(min, value), max);\n        break;\n    }\n    return value;\n  }\n\n  function fixProps(propValues) {\n    each(METER_PROPS, function(prop) {\n      var value = propValues[prop];\n      if (isVoidValue(value)) {\n        value = null;\n      }\n      if (propValues[prop] !== value) {\n        propValues[prop] = value;\n      }\n    });\n    return propValues;\n  }\n\n  function calcLevel(meter) {\n    var propValues = {};\n    each(METER_PROPS, function(prop) {\n      propValues[prop] = meter[prop];\n    });\n    propValues = fixProps(propValues);\n\n    var min = getPropValue(propValues, PROP_MIN);\n    var max = getPropValue(propValues, PROP_MAX);\n    var low = getPropValue(propValues, PROP_LOW);\n    var high = getPropValue(propValues, PROP_HIGH);\n    var optimum = getPropValue(propValues, PROP_OPTIMUM);\n    var value = getPropValue(propValues, PROP_VALUE);\n\n    var percentage = min === max ? 0 : (value - min) / (max - min) * 100;\n    var level = LEVEL_OPTIMUM;\n\n    if (\n      high === max ||\n      low === min ||\n      (optimum >= low && optimum <= high)\n    ) {\n      if (\n        (low <= optimum && value < low) ||\n        (low > optimum && value > low) ||\n        (high < optimum && value < high) ||\n        (high >= optimum && value > high)\n      ) {\n        level = LEVEL_SUBOPTIMUM;\n      }\n    } else if (low === high) {\n      if (\n        (low <= optimum && value < low) ||\n        (high > optimum && value > high)\n      ) {\n        level = LEVEL_SUBSUBOPTIMUM;\n      }\n    } else if (optimum < low) {\n      if (value > low && value <= high) {\n        level = LEVEL_SUBOPTIMUM;\n      } else if (value > high) {\n        level = LEVEL_SUBSUBOPTIMUM;\n      }\n    } else if (optimum > high) {\n      if (value >= low && value < high) {\n        level = LEVEL_SUBOPTIMUM;\n      } else if (value < low) {\n        level = LEVEL_SUBSUBOPTIMUM;\n      }\n    }\n\n    // firefox show diffently from chrome\n    // when value === high/low or min === max\n    if (isFirefox) {\n      if (min === max) {\n        percentage = 100;\n      }\n\n      if (\n          (optimum > high && value === high) ||\n          (optimum < low && value === low)\n       ) {\n        level = LEVEL_SUBOPTIMUM;\n      }\n    }\n\n    return {\n      percentage: percentage,\n      level: level,\n      className: METER_VALUE_CLASSES[level]\n    };\n  }\n\n  var meterPolyfill = {\n    CLASSES: METER_VALUE_CLASSES,\n    LEVEL_SUBOPTIMUM: LEVEL_SUBOPTIMUM,\n    LEVEL_OPTIMUM: LEVEL_OPTIMUM,\n    LEVEL_SUBSUBOPTIMUM: LEVEL_SUBSUBOPTIMUM,\n    calc: calcLevel,\n    polyfill: NOOP\n  };\n\n  if (nativeSupport) {\n    return meterPolyfill;\n  }\n\n  /* polyfill starts */\n\n  var documentElement = document.documentElement;\n\n  var defineProperty;\n  if(Object.defineProperty) {\n    defineProperty = function(o, property, etters) {\n      etters.enumerable = true;\n      etters.configurable = true;\n\n      try {\n        Object.defineProperty(o, property, etters);\n      } catch(e) {\n        if(e.number === -0x7FF5EC54) {\n          etters.enumerable = false;\n          Object.defineProperty(o, property, etters);\n        }\n      }\n    };\n  } else {\n    if ('__defineSetter__' in documentElement) {\n      defineProperty = function(o, property, etters) {\n        if (etters.get) {\n          o.__defineGetter__(property, etters.get);\n        }\n        if(etters.set) {\n          o.__defineSetter__(property, etters.set);\n        }\n      };\n    } else {\n      defineProperty = function(o, property, etters) {\n        if (etters.get) {\n          o[property] = etters.get.call(o);\n        }\n      };\n    }\n  }\n\n  // https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\n  var bind = Function.prototype.bind || function(oThis) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    var fnToBind = this;\n    var NOOP = function() {};\n    var fnBound = function() {\n        return fnToBind.apply(\n          this instanceof NOOP ? this : oThis || this,\n          args.concat(Array.prototype.slice.call(arguments))\n          );\n    };\n\n    NOOP.prototype = this.prototype || NOOP.prototype;\n    fnBound.prototype = new NOOP();\n\n    return fnBound;\n  };\n\n  var HTML_METER_ELEMENT_CONSTRICTOR_NAME = [\n    'HTML',\n    METER_TAG.replace(/^(.)(.*)$/,function(_, $1, $2){\n        return $1.toUpperCase() + $2.toLowerCase()\n    }),\n    'Element'\n  ].join('');\n\n  function createNativeFunction(fnName, fn) {\n    function toString() {\n      return 'function ' + fnName + '() { [native code] }';\n    }\n\n    var nativeToString = toString.toString.toString;\n\n    // firfox shows bound toString in console not bug\n    // ie7/8 is buggy without bind\n    toString.toString = bind.call(nativeToString, nativeToString);\n    // some browsers shows empty function name in toString.toString.toString\n    toString.toString.toString = toString.toString;\n\n    fn.toString = toString;\n    return fn;\n  }\n\n  // ie 8 document.createElement is not a function\n  // ie 7 document.createElement.apply is undefined\n  var createElement = (function(createElement) {\n    if (!createElement.apply) {\n      return createElement;\n    } else {\n      return function() {\n        return createElement.apply(document, arguments);\n      };\n    }\n  })(document[METHOD_CREATE_ELEMENT]);\n\n  var HTMLMeterElement = window[HTML_METER_ELEMENT_CONSTRICTOR_NAME] || (function() {\n    var HTMLMeterElement = createNativeFunction(HTML_METER_ELEMENT_CONSTRICTOR_NAME, function () {\n      throw new TypeError('Illegal constructor');\n    });\n\n    // ie 8 constructor is null\n    var prototype = (\n      window.HTMLElement ||\n      meterElement.constructor ||\n      window.Element ||\n      window.Node ||\n      NOOP).prototype;\n\n    if (Object.create) {\n      prototype = Object.create(prototype);\n    }\n\n    HTMLMeterElement.prototype = prototype;\n    HTMLMeterElement.constructor = HTMLMeterElement.prototype.constructor = HTMLMeterElement;\n\n    return window[HTML_METER_ELEMENT_CONSTRICTOR_NAME] = HTMLMeterElement;\n  })();\n\n  // there is no moz/ms/o vendor prefix\n  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n  var isObservered = false;\n  var isReady = false;\n\n  meterElement[METER_TAG] = METER_TAG; // for attersAsProps test\n  var supports = {\n    MutationObserver: !!MutationObserver,\n    addEventListener: !!window.addEventListener,\n    attachEvent: !!window.attachEvent,\n    attersAsProps: meterElement.getAttribute(METER_TAG) === METER_TAG, // (IE8- bug)\n    unknownElement: !!meterElement.constructor,\n    hasAttribute: !!meterElement.hasAttribute,\n    propertychange: 'onpropertychange' in document\n  };\n\n  function on(el, events, listener, useCapture) {\n    if (!el) {\n      return;\n    }\n    each(events.split(' '), function(event) {\n      if (supports.addEventListener) {\n        el.addEventListener(event, listener, !!useCapture);\n      } else if (supports.attachEvent) {\n        el.attachEvent('on' + event, listener);\n      } else {\n        el['on' + event] = listener;\n      }\n    });\n  }\n\n  if (!supports.MutationObserver) {\n    var supportsDOMNodeInserted = false;\n    var supportsDOMAttrModified = false;\n    var testDiv = createElement('div');\n    var testChild = createElement('div');\n    on(testDiv, 'DOMNodeInserted', function() {\n      supportsDOMNodeInserted = true;\n    });\n    testDiv.appendChild(testChild);\n    on(testDiv, 'DOMAttrModified', function() {\n      supportsDOMAttrModified = true;\n    });\n    testDiv.setAttribute(PROP_MIN, 1);\n    testChild = null;\n    testDiv = null;\n\n    supports.DOMNodeInserted = supportsDOMNodeInserted;\n    supports.DOMAttrModified = supportsDOMAttrModified;\n  }\n\n  var METER_SHADOW_HTML = [\n    '<div class=\"' + METER_VALUE_CLASSES.inner + '\">',\n      '<div class=\"' + METER_VALUE_CLASSES.bar + '\">',\n        '<div class=\"' + METER_VALUE_CLASSES[LEVEL_SUBOPTIMUM] + '\" style=\"width: 0\">',\n        '</div>',\n      '</div>',\n    '</div>'\n  ].join('');\n\n  var mathMin = Math[PROP_MIN];\n  var mathMax = Math[PROP_MAX];\n  var setTimeout = window.setTimeout;\n\n  function hasAttribute(el, name) {\n    if (supports.hasAttribute) {\n      return el.hasAttribute(name);\n    } else {\n      return el.getAttribute(name) !== null;\n    }\n  }\n\n  function updateMeterStyle(meter) {\n    var level = calcLevel(meter);\n\n    try {\n      var valueElement = meter.getElementsByTagName('div')[2];\n      valueElement.className = level.className;\n      valueElement.style.width = level.percentage + '%';\n    } catch(_) {}\n\n    return meter;\n  }\n\n  // over write document.createElement\n  function documentCreateElemennt() {\n    var el = createElement.apply ? createElement.apply(document, arguments) : createElement(arguments[0]);\n    if (isMeter(el)) {\n      polyfill(el);\n    }\n    return el;\n  }\n  document[METHOD_CREATE_ELEMENT] = createNativeFunction(METHOD_CREATE_ELEMENT, documentCreateElemennt);\n\n  // maybe also cloneNode ??\n\n  function observerSubtree() {\n    if (isObservered) {\n      return;\n    }\n\n    // observe subtree\n    if (supports.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          polyfill(mutation.target);\n        });\n      });\n\n      observer.observe(documentElement, {\n        subtree: true,\n        childList: true\n      });\n    } else if (supports.DOMNodeInserted) {\n      on(documentElement, 'DOMNodeInserted', function(e) {\n        polyfill(e.target);\n      });\n    } else {\n      // any idea ?\n    }\n    isObservered = true;\n  }\n\n  function polyfill(context) {\n    var meters = [];\n    if (isMeter(context)) {\n      meters = [context];\n    } else {\n      meters = (context || document).getElementsByTagName(METER_TAG);\n    }\n\n    each(meters, function(meter) {\n      if (meter['_polyfill']) {\n        return;\n      }\n\n      if (!hasAttribute(meter, '_polyfill')) {\n        meter.setAttribute('_polyfill', '');\n\n        // ie 8 throws\n        try {\n          meter.constructor = HTMLMeterElement;\n        } catch(_) {}\n\n        // ie8 need clone meter might be a new node\n        meter = createShadowDom(meter);\n        defineEtter(meter);\n        observerAttr(meter);\n      }\n\n      updateMeterStyle(meter);\n      meter['_polyfill'] = true;\n    });\n  }\n\n  function observerAttr(meter) {\n    // observe subtree\n    if (supports.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          updateMeterStyle(mutation.target);\n        });\n      });\n      observer.observe(meter, {\n        attributes: true,\n        attributeFilter: METER_PROPS\n      });\n    } else if (supports.DOMAttrModified) {\n      on(meter, 'DOMAttrModified', function(e) {\n        if (METER_PROPS.join(' ').indexOf(e.attrName) > -1) {\n          updateMeterStyle(e.target);\n        }\n      });\n    } else if (supports.propertychange) {\n      on(meter, 'propertychange', function(e) {\n        if (METER_PROPS.join(' ').indexOf(e.propertyName) > -1) {updateMeterStyle(e.srcElement);\n        }\n      });\n    } else {\n      // anything ?\n    }\n  }\n\n  function createShadowDom(meter) {\n    if (meter.canHaveChildren == false || meter.canHaveHTML == false) {\n      // ie 8 fails on innerHTML meter\n      var parent = meter.parentNode;\n      if (parent) {\n        var meterClone = createElement(METER_TAG);\n        each(METER_PROPS, function(prop) {\n          var value = meter[prop];\n          if (!isVoidValue(value)) {\n            meterClone[prop] = meter[prop];\n          }\n        });\n        parent.replaceChild(meterClone, meter);\n        meterClone.innerHTML = METER_SHADOW_HTML;\n        meter = meterClone;\n\n        // remove </meter><//meter>\n        var slashMeters = parent.getElementsByTagName('/' + METER_TAG);\n        each(slashMeters, function(slashMeter) {\n          parent.removeChild(slashMeter);\n        });\n        // anotherway remove </meter><//meter>\n        // var next = meter;\n        // while (next = next.nextSibling) {\n        //   if (next.tagName.toUpperCase() === '/' + METER_TAG) {\n        //     parent.removeChild(next);\n        //   }\n        // }\n      }\n    } else {\n      meter.innerHTML = METER_SHADOW_HTML;\n    }\n    return meter;\n  }\n\n  function defineEtter(meter) {\n    var METHOD_SET_ATTRIBUTE = 'setAttribute';\n    var METHOD_CLONE_NODE = 'cloneNode';\n    var propValues = {};\n    var setAttribute = bind.call(meter[METHOD_SET_ATTRIBUTE], meter);\n    var cloneNode = bind.call(meter[METHOD_CLONE_NODE], meter);\n\n    each(METER_PROPS, function(prop) {\n      propValues[prop] = meter.getAttribute(prop);\n    });\n\n    propValues = fixProps(propValues);\n\n    function getGetter(prop) {\n      return function() {\n        return getPropValue(propValues, prop);\n      };\n    }\n\n    function getSetter(prop) {\n      return function(value) {\n        if (isVoidValue(value)) {\n          throw new TypeError('Failed to set the \\'' + prop + '\\' property on \\'' + HTML_METER_ELEMENT_CONSTRICTOR_NAME + '\\': The provided double value is non-finite.');\n        }\n\n        setAttribute(prop, '' + meter[prop]);\n\n        propValues[prop] = value === null ? null : value;\n        updateMeterStyle(meter);\n        return value;\n      }\n    }\n\n    each(METER_PROPS, function(prop) {\n      var etters = {\n        get: getGetter(prop)\n      };\n      if (!supports.attersAsProps) {\n        etters.set = getSetter(prop);\n      }\n      defineProperty(meter, prop, etters);\n    });\n\n    var attributeSetter = createNativeFunction(METHOD_SET_ATTRIBUTE, function(attr, value) {\n      setAttribute(attr, value);\n      attr = attr.toLowerCase();\n      each(METER_PROPS, function(prop) {\n        if (prop === attr) {\n          propValues[prop] = isVoidValue(value) || value === null ? null : value;\n          updateMeterStyle(meter);\n        }\n      });\n    });\n\n    defineProperty(meter, METHOD_SET_ATTRIBUTE, {\n      value: attributeSetter\n    });\n\n    var cloneNodeMethd = createNativeFunction(METHOD_CLONE_NODE, function(deep) {\n      var clone = cloneNode(false);\n      clone.removeAttribute('_polyfill');\n      polyfill(clone);\n      return clone;\n    });\n\n    defineProperty(meter, METHOD_CLONE_NODE, {\n      value: cloneNodeMethd\n    });\n  }\n\n  (function checkReady() {\n\n    function completed() {\n      if (document.readyState === 'complete') {\n        isReady = true;\n      }\n    }\n    completed();\n\n    on(document, 'DOMContentLoaded', function() {\n      isReady = true;\n    });\n\n    on(window, 'load', function() {\n      isReady = true;\n    });\n\n    on(document, 'readystatechange', completed);\n\n    // uglify will break window without a wrapper\n    var isTop = false;\n    try {\n      isTop = window.frameElement === null;\n    } catch (_) {}\n\n    if (!supports.addEventListener && documentElement.doScroll && isTop) {\n      (function doScroll() {\n        try {\n          documentElement.doScroll();\n        } catch (_) {\n          return setTimeout(doScroll, 50);\n        }\n        isReady = true;\n      })();\n    }\n  })();\n\n  (function polyfillWhenReady() {\n    if (isReady) {\n      polyfill();\n      observerSubtree();\n    } else {\n      setTimeout(polyfillWhenReady, 50);\n    }\n  })();\n\n  meterPolyfill.polyfill = polyfill;\n  return meterPolyfill;\n});\n"]}