{"version":3,"sources":["meter-polyfill.min.js"],"names":["root","factory","define","amd","module","exports","meterPolyfill","this","window","createNativeFunction","fnName","fn","toString","nativeToString","bind","on","el","events","listener","useCapture","each","split","event","supports","addEventListener","attachEvent","arrLike","i","len","length","hasAttribute","name","getAttribute","isMeter","tagName","toUpperCase","METER_TAG","fixProps","meter","props","PROP_MIN","PROP_MAX","prop","value","isNaN","METER_INITAL_VALUES","METER_PROPS","PROP_LOW","PROP_HIGH","PROP_VALUE","removeAttribute","PROP_OPTIMUN","calcLevel","min","max","low","high","optimum","percentage","level","LEVEL_OPTIMUN","LEVEL_SUBOPTIMUN","LEVEL_SUBSUBOPTIMUN","isFirefox","style","METER_VALUE_CLASSES","createShadow","innerHTML","METER_SHADOW_HTML","setAttribute","MutationObserver","observer","mutations","mutation","updateMeterStyle","target","observe","attributes","attributeFilter","DOMNodeInserted","e","join","indexOf","attrName","propertychange","setMeterAttribute","attr","innerDivs","getElementsByTagName","valueElement","unknownElement","className","width","documentCreateElemennt","createElement","apply","document","arguments","polyfill","isObservered","DOCUMENT_CREAMENT_METHOD","documentElement","subtree","childList","context","meters","METER_CLASS_PREFIX","HTML_METER_ELEMENT_CONSTRICTOR_NAME","toLowerCase","replace","_","$1","$2","inner","bar","Function","prototype","self","call","meterElement","HTMLMeterElement","TypeError","constructor","HTMLElement","Element","Node","WebKitMutationObserver","isReady","navigator","userAgent","native","syncAttribute","supportsDOMNodeInserted","supportsDOMAttrModified","testDiv","testChild","appendChild","DOMAttrModified","Math","setTimeout","pollyfillGetterSetter","getSetter","getGetter","set","get","Object","defineProperty","checkReady","readyState","isTop","frameElement","doScroll","autoPolyfill","CLASSES","INITAL_VALUES","fix","calc"],"mappings":"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","file":"../meter-polyfill.min.js","sourcesContent":["/* globals define: true, module: true*/\n(function(root, factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], function() {\n      return factory(root);\n    });\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(root);\n  } else {\n    root.meterPolyfill = factory(root);\n  }\n})(this, function(window) {\n  'use strict';\n\n  var LEVEL_SUBOPTIMUN = 1;\n  var LEVEL_OPTIMUN = 2;\n  var LEVEL_SUBSUBOPTIMUN = 3;\n  var PROP_MIN = 'min';\n  var PROP_MAX = 'max';\n  var PROP_LOW = 'low';\n  var PROP_HIGH = 'high';\n  var PROP_VALUE = 'value';\n  var PROP_OPTIMUN = 'optimum';\n  var METER_PROPS = [PROP_MIN, PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUN];\n  var METER_TAG = 'METER';\n  var METER_CLASS_PREFIX = 'meter-';\n  var HTML_METER_ELEMENT_CONSTRICTOR_NAME = 'HTML' +\n    METER_TAG.toLowerCase().replace(/^(.)(.*)$/,function(_, $1, $2){\n        return $1.toUpperCase() + $2.toLowerCase()\n    }) +\n    'Element';\n  var DOCUMENT_CREAMENT_METHOD = 'createElement';\n\n  var METER_VALUE_CLASSES = {\n    inner: METER_CLASS_PREFIX + 'inner-element',\n    bar: METER_CLASS_PREFIX + 'bar'\n  };\n\n  METER_VALUE_CLASSES[LEVEL_OPTIMUN] = METER_CLASS_PREFIX + 'optimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBOPTIMUN] = METER_CLASS_PREFIX + 'suboptimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBSUBOPTIMUN] = METER_CLASS_PREFIX + 'even-less-good-value';\n\n  if (!Function.prototype.bind) {\n    Function.prototype.bind = function(self) {\n      var fn = this;\n      return function() {\n        return fn.apply(self, arguments);\n      };\n    };\n  }\n\n  var document = window.document;\n  var documentElement = document.documentElement;\n  // ie 8. document.createElement is not a function\n  var createElement = Function.prototype.bind.call(document[DOCUMENT_CREAMENT_METHOD], document);\n\n  function createNativeFunction(fnName, fn) {\n    function toString() {\n      return 'function ' + fnName + '() { [native code] }';\n    }\n\n    var nativeToString = toString.toString.toString;\n\n    // firfox shows bound toString in console not bug\n    // ie7/8 is buggy without bind\n    toString.toString = nativeToString.bind(nativeToString);\n    // some browsers shows empty function name in toString.toString.toString\n    toString.toString.toString = toString.toString;\n\n    fn.toString = toString;\n    return fn;\n  }\n\n  var meterElement = createElement(METER_TAG);\n\n  var HTMLMeterElement = window[HTML_METER_ELEMENT_CONSTRICTOR_NAME] || (function() {\n    function HTMLMeterElement() {\n      throw new TypeError('Illegal constructor');\n    }\n    HTMLMeterElement.constructor = HTMLMeterElement;\n     // ie 8 constructor is null\n    HTMLMeterElement.prototype = (\n      window.HTMLElement ||\n      meterElement.constructor ||\n      window.Element ||\n      window.Node ||\n      function() {}).prototype;\n    return window[HTML_METER_ELEMENT_CONSTRICTOR_NAME] = createNativeFunction(HTML_METER_ELEMENT_CONSTRICTOR_NAME, HTMLMeterElement);\n  })();\n\n  // there is no moz/ms/o vendor prefix\n  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n  var isObservered = false;\n  var isReady = false;\n  // TODO:\n  // use getComputedStyle find the right calculator\n  var isFirefox = window.navigator.userAgent.indexOf('Firefox') > -1;\n\n  meterElement[PROP_MIN] = '0';\n  meterElement.setAttribute(PROP_HIGH, '1');\n\n  var supports = {\n    native: meterElement[PROP_MAX] === 1,\n    MutationObserver: !!MutationObserver,\n    addEventListener: !!window.addEventListener,\n    attachEvent: !!window.attachEvent,\n    syncAttribute: meterElement.getAttribute(PROP_MIN) === '0' && meterElement[PROP_HIGH] === '1',\n    unknownElement: !!meterElement.constructor,\n    hasAttribute: !!meterElement.hasAttribute,\n    propertychange: 'onpropertychange' in document\n  };\n\n  function on(el, events, listener, useCapture) {\n    each(events.split(' '), function(event) {\n      if (supports.addEventListener) {\n        el.addEventListener(event, listener, !!useCapture);\n      } else if (supports.attachEvent) {\n        el.attachEvent('on' + event, listener);\n      } else {\n        el['on' + event] = listener;\n      }\n    });\n  }\n\n  if (!supports.MutationObserver) {\n    var supportsDOMNodeInserted = false;\n    var supportsDOMAttrModified = false;\n    var testDiv = createElement('div');\n    var testChild = createElement('div');\n    on(testDiv, 'DOMNodeInserted', function() {\n      supportsDOMNodeInserted = true;\n    });\n    testDiv.appendChild(testChild);\n    on(testDiv, 'DOMAttrModified', function() {\n      supportsDOMAttrModified = true;\n    });\n    testDiv.setAttribute(PROP_MIN, 1);\n    testChild = null;\n    testDiv = null;\n\n    supports.DOMNodeInserted = supportsDOMNodeInserted;\n    supports.DOMAttrModified = supportsDOMAttrModified;\n  }\n\n  var METER_INITAL_VALUES = {\n    min: 0,\n    max: 1,\n    low: 0,\n    high: 1\n  };\n\n  var METER_SHADOW_HTML = [\n    '<div class=\"' + METER_VALUE_CLASSES.inner + '\">',\n      '<div class=\"' + METER_VALUE_CLASSES.bar + '\">',\n        '<div class=\"' + METER_VALUE_CLASSES[LEVEL_SUBOPTIMUN] + '\" style=\"width: 0\">',\n        '</div>',\n      '</div>',\n    '</div>'\n  ].join('');\n\n  var min = Math[PROP_MIN];\n  var max = Math[PROP_MAX];\n  var setTimeout = window.setTimeout;\n\n\n  // help functions\n  function each(arrLike, fn) {\n    for (var i = 0, len = arrLike.length; i < len; i++) {\n      fn(arrLike[i], i);\n    }\n  }\n\n  function hasAttribute(el, name) {\n    if (supports.hasAttribute) {\n      return el.hasAttribute(name);\n    } else {\n      return el.getAttribute(name) !== null;\n    }\n  }\n\n  function isMeter(el) {\n    return el && el.tagName && el.tagName.toUpperCase() === METER_TAG;\n  }\n\n  function fixProps(meter, props) {\n    // must has a min/max value\n    each([PROP_MIN, PROP_MAX], function(prop) {\n      var value = +meter[prop];\n      if (isNaN(value)) {\n        meter[prop] = METER_INITAL_VALUES[prop];\n      }\n    });\n    each(props || METER_PROPS, function(prop) {\n      switch (prop) {\n        case PROP_MAX:\n          if (meter[PROP_MAX] < meter[PROP_MIN]) {\n            meter[PROP_MAX] = meter[PROP_MIN];\n          }\n          break;\n        case PROP_LOW:\n          if (meter[PROP_LOW] < meter[PROP_MIN]) {\n            meter[PROP_LOW] = meter[PROP_MIN];\n          }\n          break;\n        case PROP_HIGH:\n          if (meter[PROP_HIGH] > meter[PROP_MAX]) {\n            meter[PROP_HIGH] = meter[PROP_MAX];\n          }\n          if (meter[PROP_HIGH] < meter[PROP_LOW]) {\n            meter[PROP_HIGH] = meter[PROP_LOW];\n          }\n          break;\n        case PROP_VALUE:\n          if (isMeter(meter) && typeof meter[PROP_VALUE] === 'undefined') {\n            meter.removeAttribute(PROP_VALUE);\n          } else {\n            if (\n              (meter[PROP_VALUE] < meter[PROP_MIN]) ||\n              (typeof meter[PROP_VALUE] === 'undefined')\n            ) {\n              meter[PROP_VALUE] = meter[PROP_MIN];\n            }\n            if (meter[PROP_VALUE] > meter[PROP_MAX]) {\n              meter[PROP_VALUE] = meter[PROP_MAX];\n            }\n          }\n          break;\n        case PROP_OPTIMUN:\n          if (\n            (typeof meter[PROP_OPTIMUN] === 'undefined') ||\n            (meter[PROP_OPTIMUN] < meter[PROP_MIN] || meter[PROP_OPTIMUN] > meter[PROP_MAX])\n          ) {\n            if (isMeter(meter)) {\n              meter.removeAttribute(PROP_OPTIMUN);\n            } else {\n              meter[PROP_OPTIMUN] = meter[PROP_MIN] + (meter[PROP_MAX] - meter[PROP_MIN]) / 2;\n            }\n          }\n          break;\n        default:\n          break;\n      }\n    });\n    return meter;\n  }\n\n  function calcLevel(props) {\n    props = fixProps(props);\n\n    var min = props[PROP_MIN];\n    var max = props[PROP_MAX];\n    var low = props[PROP_LOW];\n    var high = props[PROP_HIGH];\n    var optimum = props[PROP_OPTIMUN];\n    var value = props[PROP_VALUE];\n\n    var percentage = min === max ? 0 : (value - min) / (max - min) * 100;\n    var level = LEVEL_OPTIMUN;\n\n    if (\n      high === max ||\n      low === min ||\n      (optimum >= low && optimum <= high)\n    ) {\n      if (\n        (low <= optimum && value < low) ||\n        (low > optimum && value > low) ||\n        (high < optimum && value < high) ||\n        (high >= optimum && value > high)\n      ) {\n        level = LEVEL_SUBOPTIMUN;\n      }\n    } else if (low === high) {\n      if (\n        (low <= optimum && value < low) ||\n        (high > optimum && value > high)\n      ) {\n        level = LEVEL_SUBSUBOPTIMUN;\n      }\n    } else if (optimum < low) {\n      if (value > low && value <= high) {\n        level = LEVEL_SUBOPTIMUN;\n      } else if (value > high) {\n        level = LEVEL_SUBSUBOPTIMUN;\n      }\n    } else if (optimum > high) {\n      if (value >= low && value < high) {\n        level = LEVEL_SUBOPTIMUN;\n      } else if (value < low) {\n        level = LEVEL_SUBSUBOPTIMUN;\n      }\n    }\n\n    // firefox show diffently from chrome when\n    // value === high/low\n    if (isFirefox &&\n      (\n        (optimum > high && value === high) ||\n        (optimum < low && value === low)\n      )\n     ) {\n      level = LEVEL_SUBOPTIMUN;\n    }\n\n    return {\n      percentage: percentage,\n      level: level,\n      style: METER_VALUE_CLASSES[level]\n    };\n  }\n\n  function createShadow(meter) {\n    if (supports.native || !isMeter(meter) || hasAttribute(meter, '_polyfill')) {\n      return meter;\n    }\n\n    meter.innerHTML = METER_SHADOW_HTML;\n    meter.setAttribute('_polyfill', '');\n\n    // meter.__proto__ = window[HTML_METER_ELEMENT_CONSTRICTOR_NAME].prototype;\n    fixProps(meter, [PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE]);\n\n    // observe subtree\n    if (supports.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          updateMeterStyle(mutation.target);\n        });\n      });\n      observer.observe(meter, {\n        attributes: true,\n        attributeFilter: METER_PROPS\n      });\n    } else if (supports.DOMNodeInserted) {\n      on(meter, 'DOMAttrModified', function(e) {\n        if (METER_PROPS.join(' ').indexOf(e.attrName) > -1) {\n          updateMeterStyle(e.target);\n        }\n      });\n    } else if (supports.propertychange) {\n      on(meter, 'propertychange', function(e) {\n        // console.log('propertychange');\n        // console.log(e);\n      });\n    } else {\n      // anything ?\n    }\n    updateMeterStyle(meter);\n    return meter;\n  }\n\n  function setMeterAttribute(meter, attr, value) {\n    switch (attr) {\n      case PROP_MIN:\n        meter.setAttribute(attr, value);\n        fixProps(meter, [PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUN]);\n        break;\n      case PROP_MAX:\n        value = max(value, meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        fixProps(meter, [PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUN]);\n        break;\n      case PROP_LOW:\n        value = min(max(value, meter[PROP_MIN]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        fixProps(meter, [PROP_HIGH]);\n        break;\n      case PROP_HIGH:\n        value = min(max(value, meter[PROP_MIN], meter[PROP_LOW]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        break;\n      case PROP_OPTIMUN:\n        value = min(max(value, meter[PROP_MIN]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        break;\n      default:\n        meter.setAttribute(attr, value);\n    }\n    updateMeterStyle(meter);\n  }\n\n  function updateMeterStyle(meter) {\n    if (supports.native) {\n      return;\n    }\n\n    if (!hasAttribute(meter, '_polyfill')) {\n      return createShadow(meter);\n    }\n    var innerDivs = meter.getElementsByTagName('div');\n    if (!innerDivs.length || !innerDivs[2]) {\n      throw 'meter polyfilled shadow dom is not currect.';\n    }\n    var valueElement = innerDivs[2];\n\n    var props = {};\n    each(METER_PROPS, function(prop) {\n      if (supports.unknownElement) {\n        props[prop] = +meter[prop];\n      } else if (hasAttribute(meter, prop)) {\n        props[prop] = +meter.getAttribute(prop);\n      } else {\n        props[prop] = METER_INITAL_VALUES[prop];\n      }\n    });\n\n    var level = calcLevel(props);\n    valueElement.className = METER_VALUE_CLASSES[level.level];\n    valueElement.style.width = level.percentage + '%';\n\n    return meter;\n  }\n\n  function observer() {\n    if (supports.native || isObservered) {\n      return;\n    }\n\n    // over write document.createElement\n    function documentCreateElemennt(tagName) {\n      var el = createElement.apply(document, arguments);\n      if (isMeter(el)) {\n        polyfill(el);\n      }\n      return el;\n    }\n    document[DOCUMENT_CREAMENT_METHOD] = createNativeFunction([DOCUMENT_CREAMENT_METHOD], documentCreateElemennt);\n\n\n    // observe subtree\n    if (supports.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          polyfill(mutation.target);\n        });\n      });\n\n      observer.observe(documentElement, {\n        subtree: true,\n        childList: true\n      });\n    } else if (supports.DOMNodeInserted) {\n      on(documentElement, 'DOMNodeInserted', function(e) {\n        polyfill(e.target);\n      });\n    } else {\n      // any idea ?\n    }\n    isObservered = true;\n  }\n\n  function polyfill(context) {\n    if (supports.native) {\n      return;\n    }\n\n    var meters = [];\n    if (isMeter(context)) {\n      meters = [context];\n    } else {\n      meters = (context || documentElement).getElementsByTagName(METER_TAG);\n    }\n\n    each(meters, function(meter) {\n      updateMeterStyle(meter);\n    });\n  }\n\n  (function pollyfillGetterSetter() {\n    if (!supports.unknownElement) {\n      return;\n    }\n\n    var prototype = meterElement.constructor.prototype;\n    function getSetter(prop) {\n      return function(value) {\n        if (isMeter(this)) {\n          setMeterAttribute(this, prop.toLowerCase(), +value);\n        } else {\n          return this[prop] = value;\n        }\n      };\n    }\n\n    function getGetter(prop) {\n      return function() {\n        if (isMeter(this)) {\n          if (hasAttribute(this, prop)) {\n            return +this.getAttribute(prop);\n          } else if (prop === PROP_LOW) {\n            return this[PROP_MIN];\n          } else if (prop === PROP_HIGH) {\n            return this[PROP_MAX];\n          } else if (prop === PROP_OPTIMUN) {\n            return (this[PROP_MAX] - this[PROP_MIN]) / 2 + this[PROP_MIN];\n          } else if (prop === PROP_VALUE) {\n            return this[PROP_MIN];\n          }\n          return METER_INITAL_VALUES[prop];\n        }\n\n        return this.getAttribute(prop);\n      };\n    }\n\n    each(METER_PROPS, function(prop) {\n      var props = {\n        // enumerable: true, // can't do this on ie8\n        // configurable: true\n      };\n      if (!supports.syncAttribute) {\n        props.set = getSetter(prop);\n      }\n      props.get = getGetter(prop);\n      Object.defineProperty(prototype, prop, props);\n    });\n\n    // ie 8\n    // var setAttribute = prototype.setAttribute;\n    // console.log(setAttribute);\n    // Object.defineProperty(prototype, 'setAttribute', {\n    //   value: function(prop, value) {\n    //     this[prop] = value;\n    //     if (isMeter(this)) {\n    //       console.log('update');\n    //       updateMeterStyle(this);\n    //     }\n    //   }\n    // });\n  })();\n\n  (function checkReady() {\n    if (document.readyState === 'complete') {\n      isReady = true;\n    }\n\n    on(document, 'DOMContentLoaded', function() {\n      isReady = true;\n    });\n\n    on(window, 'load', function() {\n      isReady = true;\n    });\n\n    // uglify will break window without a wrapper\n    var isTop = false;\n    try {\n      isTop = window.frameElement === null;\n    } catch (_) {}\n\n    if (!supports.addEventListener && documentElement.doScroll && isTop) {\n      (function doScroll() {\n        try {\n          documentElement.doScroll('left');\n        } catch (_) {\n          return setTimeout(doScroll, 50);\n        }\n        isReady = true;\n      })();\n    }\n  })();\n\n  (function autoPolyfill() {\n    if (isReady) {\n      polyfill();\n      observer();\n    } else {\n      setTimeout(autoPolyfill, 50);\n    }\n  })();\n\n  return {\n    CLASSES: METER_VALUE_CLASSES,\n    INITAL_VALUES: METER_INITAL_VALUES,\n    LEVEL_SUBOPTIMUN: LEVEL_SUBOPTIMUN,\n    LEVEL_OPTIMUN: LEVEL_OPTIMUN,\n    LEVEL_SUBSUBOPTIMUN: LEVEL_SUBSUBOPTIMUN,\n    polyfill: polyfill,\n    fix: fixProps,\n    calc: calcLevel\n  };\n\n});\n"]}