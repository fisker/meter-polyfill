{"version":3,"sources":["meter-polyfill.min.js"],"names":["root","factory","define","amd","module","exports","meterPolyfill","this","window","createNativeFunction","fnName","fn","toString","nativeToString","bind","isUndefined","obj","isMeter","el","tagName","toUpperCase","METER_TAG","fixProps","meter","props","isMeterElement","each","PROP_MIN","PROP_MAX","prop","value","isNaN","METER_INITAL_VALUES","METER_PROPS","PROP_LOW","PROP_HIGH","PROP_VALUE","removeAttribute","PROP_OPTIMUM","calcLevel","min","max","low","high","optimum","percentage","level","LEVEL_OPTIMUM","LEVEL_SUBOPTIMUM","LEVEL_SUBSUBOPTIMUM","isFirefox","className","METER_VALUE_CLASSES","on","events","listener","useCapture","split","event","supports","addEventListener","attachEvent","arrLike","i","len","length","hasAttribute","name","getAttribute","createShadow","innerHTML","METER_SHADOW_HTML","setAttribute","MutationObserver","observer","mutations","mutation","updateMeterStyle","target","observe","attributes","attributeFilter","DOMNodeInserted","e","join","indexOf","attrName","propertychange","setMeterAttribute","attr","innerDivs","getElementsByTagName","Error","valueElement","unknownElement","style","width","observerSubtree","documentCreateElemennt","createElement","apply","document","arguments","polyfill","isObservered","DOCUMENT_CREAMENT_METHOD","documentElement","subtree","childList","context","meters","METER_CLASS_PREFIX","HTML_METER_ELEMENT_CONSTRICTOR_NAME","replace","_","$1","$2","toLowerCase","inner","bar","NOOP","CLASSES","INITAL_VALUES","Function","prototype","self","call","meterElement","HTMLMeterElement","TypeError","HTMLElement","constructor","Element","Node","Object","create","nativeFn","WebKitMutationObserver","isReady","navigator","userAgent","fix","calc","native","attersAsProps","supportsDOMNodeInserted","supportsDOMAttrModified","testDiv","testChild","appendChild","DOMAttrModified","Math","setTimeout","pollyfillGetterSetter","getSetter","getGetter","defineProperty","set","get","checkReady","completed","readyState","isTop","frameElement","doScroll","polyfillWhenReady"],"mappings":"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","file":"../meter-polyfill.min.js","sourcesContent":["/* globals define: true, module: true*/\n(function(root, factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    define(factory(root));\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(root);\n  } else {\n    root.meterPolyfill = factory(root);\n  }\n})(this, function(window) {\n  'use strict';\n\n  var METER_TAG = '<%= METER_TAG %>';\n  var LEVEL_OPTIMUM = 1;\n  var LEVEL_SUBOPTIMUM = 2;\n  var LEVEL_SUBSUBOPTIMUM = 3;\n  var PROP_MIN = 'min';\n  var PROP_MAX = 'max';\n  var PROP_LOW = 'low';\n  var PROP_HIGH = 'high';\n  var PROP_VALUE = 'value';\n  var PROP_OPTIMUM = 'optimum';\n  var METER_PROPS = [PROP_MIN, PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUM];\n  var METER_CLASS_PREFIX = 'meter-';\n  var HTML_METER_ELEMENT_CONSTRICTOR_NAME = [\n    'HTML',\n    METER_TAG.replace(/^(.)(.*)$/,function(_, $1, $2){\n        return $1.toUpperCase() + $2.toLowerCase()\n    }),\n    'Element'].join('');\n  var DOCUMENT_CREAMENT_METHOD = 'createElement';\n\n  var METER_VALUE_CLASSES = {\n    inner: METER_CLASS_PREFIX + 'inner-element',\n    bar: METER_CLASS_PREFIX + 'bar'\n  };\n\n  METER_VALUE_CLASSES[LEVEL_OPTIMUM] = METER_CLASS_PREFIX + 'optimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBOPTIMUM] = METER_CLASS_PREFIX + 'suboptimum-value';\n  METER_VALUE_CLASSES[LEVEL_SUBSUBOPTIMUM] = METER_CLASS_PREFIX + 'even-less-good-value';\n\n  var METER_INITAL_VALUES = {\n    min: 0,\n    max: 1,\n    low: 0,\n    high: 1\n  };\n\n  var NOOP = function() {};\n\n  var meterPolyfill = {\n    CLASSES: METER_VALUE_CLASSES,\n    INITAL_VALUES: METER_INITAL_VALUES,\n    LEVEL_SUBOPTIMUM: LEVEL_SUBOPTIMUM,\n    LEVEL_OPTIMUM: LEVEL_OPTIMUM,\n    LEVEL_SUBSUBOPTIMUM: LEVEL_SUBSUBOPTIMUM,\n    polyfill: NOOP\n  };\n\n  if (!Function.prototype.bind) {\n    Function.prototype.bind = function(self) {\n      var fn = this;\n      return function() {\n        return fn.apply(self, arguments);\n      };\n    };\n  }\n\n  var document = window.document;\n  var documentElement = document.documentElement;\n  // ie 8. document.createElement is not a function\n  var createElement = Function.prototype.bind.call(document[DOCUMENT_CREAMENT_METHOD], document);\n\n  function createNativeFunction(fnName, fn) {\n    function toString() {\n      return 'function ' + fnName + '() { [native code] }';\n    }\n\n    var nativeToString = toString.toString.toString;\n\n    // firfox shows bound toString in console not bug\n    // ie7/8 is buggy without bind\n    toString.toString = nativeToString.bind(nativeToString);\n    // some browsers shows empty function name in toString.toString.toString\n    toString.toString.toString = toString.toString;\n\n    fn.toString = toString;\n    return fn;\n  }\n\n  var meterElement = createElement(METER_TAG);\n\n  var HTMLMeterElement = window[HTML_METER_ELEMENT_CONSTRICTOR_NAME] || (function() {\n    function HTMLMeterElement() {\n      throw new TypeError('Illegal constructor');\n    }\n\n    // ie 8 constructor is null\n    var prototype = (\n      window.HTMLElement ||\n      meterElement.constructor ||\n      window.Element ||\n      window.Node ||\n      function() {}).prototype;\n\n    if (Object.create) {\n      prototype = Object.create(prototype);\n    }\n\n    HTMLMeterElement.prototype = prototype;\n\n    var nativeFn = createNativeFunction(HTML_METER_ELEMENT_CONSTRICTOR_NAME, HTMLMeterElement);\n    nativeFn.constructor = nativeFn.prototype.constructor = nativeFn;\n    return window[HTML_METER_ELEMENT_CONSTRICTOR_NAME] = nativeFn;\n  })();\n\n  // there is no moz/ms/o vendor prefix\n  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n  var isObservered = false;\n  var isReady = false;\n  // TODO:\n  // use getComputedStyle find the right calculator\n  var isFirefox = window.navigator.userAgent.indexOf('Firefox') > -1;\n\n  function isUndefined(obj) {\n    return typeof obj === 'undefined';\n  }\n\n  function isMeter(el) {\n    return el && el.tagName && el.tagName.toUpperCase() === METER_TAG;\n  }\n\n  function fixProps(meter, props) {\n    var isMeterElement = isMeter(meter);\n    // must has a min/max value\n    each([PROP_MIN, PROP_MAX], function(prop) {\n      var value = +meter[prop];\n      if (isNaN(value)) {\n        meter[prop] = METER_INITAL_VALUES[prop];\n      }\n    });\n    each(props || METER_PROPS, function(prop) {\n      switch (prop) {\n        case PROP_MAX:\n          if (meter[PROP_MAX] < meter[PROP_MIN]) {\n            meter[PROP_MAX] = meter[PROP_MIN];\n          }\n          break;\n        case PROP_LOW:\n          if (meter[PROP_LOW] < meter[PROP_MIN]) {\n            meter[PROP_LOW] = meter[PROP_MIN];\n          }\n          if (!isMeterElement && isUndefined(meter[PROP_LOW])) {\n            meter[PROP_LOW] = meter[PROP_MIN];\n          }\n          break;\n        case PROP_HIGH:\n          if (meter[PROP_HIGH] > meter[PROP_MAX]) {\n            meter[PROP_HIGH] = meter[PROP_MAX];\n          }\n          if (meter[PROP_HIGH] < meter[PROP_LOW]) {\n            meter[PROP_HIGH] = meter[PROP_LOW];\n          }\n          if (!isMeterElement && isUndefined(meter[PROP_HIGH])) {\n            meter[PROP_HIGH] = meter[PROP_MAX];\n          }\n          break;\n        case PROP_VALUE:\n          if (isMeterElement && isUndefined(meter[PROP_VALUE])) {\n            meter.removeAttribute(PROP_VALUE);\n          } else {\n            if (\n              (meter[PROP_VALUE] < meter[PROP_MIN]) ||\n              (typeof meter[PROP_VALUE] === 'undefined')\n            ) {\n              meter[PROP_VALUE] = meter[PROP_MIN];\n            }\n            if (meter[PROP_VALUE] > meter[PROP_MAX]) {\n              meter[PROP_VALUE] = meter[PROP_MAX];\n            }\n          }\n          break;\n        case PROP_OPTIMUM:\n          if (\n            isUndefined(meter[PROP_OPTIMUM]) ||\n            (meter[PROP_OPTIMUM] < meter[PROP_MIN] || meter[PROP_OPTIMUM] > meter[PROP_MAX])\n          ) {\n            if (isMeterElement) {\n              meter.removeAttribute(PROP_OPTIMUM);\n            } else {\n              meter[PROP_OPTIMUM] = meter[PROP_MIN] + (meter[PROP_MAX] - meter[PROP_MIN]) / 2;\n            }\n          }\n          break;\n        default:\n          break;\n      }\n    });\n    return meter;\n  }\n\n  function calcLevel(props) {\n    props = fixProps(props);\n\n    var min = props[PROP_MIN];\n    var max = props[PROP_MAX];\n    var low = props[PROP_LOW];\n    var high = props[PROP_HIGH];\n    var optimum = props[PROP_OPTIMUM];\n    var value = props[PROP_VALUE];\n\n    var percentage = min === max ? 0 : (value - min) / (max - min) * 100;\n    var level = LEVEL_OPTIMUM;\n\n    if (\n      high === max ||\n      low === min ||\n      (optimum >= low && optimum <= high)\n    ) {\n      if (\n        (low <= optimum && value < low) ||\n        (low > optimum && value > low) ||\n        (high < optimum && value < high) ||\n        (high >= optimum && value > high)\n      ) {\n        level = LEVEL_SUBOPTIMUM;\n      }\n    } else if (low === high) {\n      if (\n        (low <= optimum && value < low) ||\n        (high > optimum && value > high)\n      ) {\n        level = LEVEL_SUBSUBOPTIMUM;\n      }\n    } else if (optimum < low) {\n      if (value > low && value <= high) {\n        level = LEVEL_SUBOPTIMUM;\n      } else if (value > high) {\n        level = LEVEL_SUBSUBOPTIMUM;\n      }\n    } else if (optimum > high) {\n      if (value >= low && value < high) {\n        level = LEVEL_SUBOPTIMUM;\n      } else if (value < low) {\n        level = LEVEL_SUBSUBOPTIMUM;\n      }\n    }\n\n    // firefox show diffently from chrome when\n    // value === high/low && min === max\n    if (isFirefox && min === max) {\n      percentage = 100;\n    }\n\n\n    if (isFirefox &&\n      (\n        (optimum > high && value === high) ||\n        (optimum < low && value === low)\n      )\n     ) {\n      level = LEVEL_SUBOPTIMUM;\n    }\n\n    return {\n      percentage: percentage,\n      level: level,\n      className: METER_VALUE_CLASSES[level]\n    };\n  }\n\n  meterPolyfill.fix = fixProps;\n  meterPolyfill.calc = calcLevel;\n\n  if (meterElement[PROP_MAX] === METER_INITAL_VALUES[PROP_MAX]) {\n    return meterPolyfill;\n  }\n\n\n  meterElement[METER_TAG] = METER_TAG;\n  var supports = {\n    native: meterElement[PROP_MAX] === METER_INITAL_VALUES[PROP_MAX],\n    MutationObserver: !!MutationObserver,\n    addEventListener: !!window.addEventListener,\n    attachEvent: !!window.attachEvent,\n    attersAsProps: meterElement.getAttribute(METER_TAG) === METER_TAG, // (IE8- bug)\n    unknownElement: !!meterElement.constructor,\n    hasAttribute: !!meterElement.hasAttribute,\n    propertychange: 'onpropertychange' in document\n  };\n\n  function on(el, events, listener, useCapture) {\n    each(events.split(' '), function(event) {\n      if (supports.addEventListener) {\n        el.addEventListener(event, listener, !!useCapture);\n      } else if (supports.attachEvent) {\n        el.attachEvent('on' + event, listener);\n      } else {\n        el['on' + event] = listener;\n      }\n    });\n  }\n\n  if (!supports.MutationObserver) {\n    var supportsDOMNodeInserted = false;\n    var supportsDOMAttrModified = false;\n    var testDiv = createElement('div');\n    var testChild = createElement('div');\n    on(testDiv, 'DOMNodeInserted', function() {\n      supportsDOMNodeInserted = true;\n    });\n    testDiv.appendChild(testChild);\n    on(testDiv, 'DOMAttrModified', function() {\n      supportsDOMAttrModified = true;\n    });\n    testDiv.setAttribute(PROP_MIN, 1);\n    testChild = null;\n    testDiv = null;\n\n    supports.DOMNodeInserted = supportsDOMNodeInserted;\n    supports.DOMAttrModified = supportsDOMAttrModified;\n  }\n\n  var METER_SHADOW_HTML = [\n    '<div class=\"' + METER_VALUE_CLASSES.inner + '\">',\n      '<div class=\"' + METER_VALUE_CLASSES.bar + '\">',\n        '<div class=\"' + METER_VALUE_CLASSES[LEVEL_SUBOPTIMUM] + '\" style=\"width: 0\">',\n        '</div>',\n      '</div>',\n    '</div>'\n  ].join('');\n\n  var min = Math[PROP_MIN];\n  var max = Math[PROP_MAX];\n  var setTimeout = window.setTimeout;\n\n\n  // help functions\n\n  function each(arrLike, fn) {\n    for (var i = 0, len = arrLike.length; i < len; i++) {\n      fn(arrLike[i], i);\n    }\n  }\n\n  function hasAttribute(el, name) {\n    if (supports.hasAttribute) {\n      return el.hasAttribute(name);\n    } else {\n      return el.getAttribute(name) !== null;\n    }\n  }\n\n  function createShadow(meter) {\n    if (supports.native || !isMeter(meter) || hasAttribute(meter, '_polyfill')) {\n      return meter;\n    }\n\n    meter.innerHTML = METER_SHADOW_HTML;\n    meter.setAttribute('_polyfill', '');\n\n    // meter.__proto__ = window[HTML_METER_ELEMENT_CONSTRICTOR_NAME].prototype;\n    fixProps(meter, [PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE]);\n\n    // observe subtree\n    if (supports.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          updateMeterStyle(mutation.target);\n        });\n      });\n      observer.observe(meter, {\n        attributes: true,\n        attributeFilter: METER_PROPS\n      });\n    } else if (supports.DOMNodeInserted) {\n      on(meter, 'DOMAttrModified', function(e) {\n        if (METER_PROPS.join(' ').indexOf(e.attrName) > -1) {\n          updateMeterStyle(e.target);\n        }\n      });\n    } else if (supports.propertychange) {\n      on(meter, 'propertychange', function(e) {\n        // console.log('propertychange');\n        // console.log(e);\n      });\n    } else {\n      // anything ?\n    }\n    updateMeterStyle(meter);\n    return meter;\n  }\n\n  function setMeterAttribute(meter, attr, value) {\n    switch (attr) {\n      case PROP_MIN:\n        meter.setAttribute(attr, value);\n        fixProps(meter, [PROP_MAX, PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUM]);\n        break;\n      case PROP_MAX:\n        value = max(value, meter[PROP_MIN]);\n        meter.setAttribute(attr, value);\n        fixProps(meter, [PROP_LOW, PROP_HIGH, PROP_VALUE, PROP_OPTIMUM]);\n        break;\n      case PROP_LOW:\n        value = min(max(value, meter[PROP_MIN]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        fixProps(meter, [PROP_HIGH]);\n        break;\n      case PROP_HIGH:\n        value = min(max(value, meter[PROP_MIN], meter[PROP_LOW]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        break;\n      case PROP_OPTIMUM:\n        value = min(max(value, meter[PROP_MIN]), meter[PROP_MAX]);\n        meter.setAttribute(attr, value);\n        break;\n      default:\n        meter.setAttribute(attr, value);\n    }\n    updateMeterStyle(meter);\n  }\n\n  function updateMeterStyle(meter) {\n    if (supports.native) {\n      return;\n    }\n\n    if (!hasAttribute(meter, '_polyfill')) {\n      return createShadow(meter);\n    }\n    var innerDivs = meter.getElementsByTagName('div');\n    if (!innerDivs.length || !innerDivs[2]) {\n      throw new Error(METER_TAG + ' polyfilled shadow dom is not currect.');\n    }\n    var valueElement = innerDivs[2];\n\n    var props = {};\n    each(METER_PROPS, function(prop) {\n      if (supports.unknownElement) {\n        props[prop] = +meter[prop];\n      } else if (hasAttribute(meter, prop)) {\n        props[prop] = +meter.getAttribute(prop);\n      } else {\n        props[prop] = METER_INITAL_VALUES[prop];\n      }\n    });\n\n    var level = calcLevel(props);\n    valueElement.className = level.className;\n    valueElement.style.width = level.percentage + '%';\n\n    return meter;\n  }\n\n  function observerSubtree() {\n    if (supports.native || isObservered) {\n      return;\n    }\n\n    // over write document.createElement\n    function documentCreateElemennt(tagName) {\n      var el = createElement.apply(document, arguments);\n      if (isMeter(el)) {\n        polyfill(el);\n      }\n      return el;\n    }\n    document[DOCUMENT_CREAMENT_METHOD] = createNativeFunction([DOCUMENT_CREAMENT_METHOD], documentCreateElemennt);\n\n\n    // observe subtree\n    if (supports.MutationObserver) {\n      var observer = new MutationObserver(function(mutations) {\n        each(mutations, function(mutation) {\n          polyfill(mutation.target);\n        });\n      });\n\n      observer.observe(documentElement, {\n        subtree: true,\n        childList: true\n      });\n    } else if (supports.DOMNodeInserted) {\n      on(documentElement, 'DOMNodeInserted', function(e) {\n        polyfill(e.target);\n      });\n    } else {\n      // any idea ?\n    }\n    isObservered = true;\n  }\n\n  function polyfill(context) {\n    if (supports.native) {\n      return;\n    }\n\n    var meters = [];\n    if (isMeter(context)) {\n      meters = [context];\n    } else {\n      meters = (context || documentElement).getElementsByTagName(METER_TAG);\n    }\n\n    each(meters, function(meter) {\n      updateMeterStyle(meter);\n    });\n  }\n\n  (function pollyfillGetterSetter() {\n    if (!supports.unknownElement) {\n      return;\n    }\n\n    var prototype = meterElement.constructor.prototype;\n    function getSetter(prop) {\n      return function(value) {\n        if(!supports.attersAsProps && isMeter(this)) {\n          setMeterAttribute(this, prop.toLowerCase(), +value);\n        }\n      };\n    }\n\n    function getGetter(prop) {\n      return function() {\n        if (isMeter(this)) {\n          if (hasAttribute(this, prop)) {\n            return +this.getAttribute(prop);\n          } else if (prop === PROP_LOW) {\n            return this[PROP_MIN];\n          } else if (prop === PROP_HIGH) {\n            return this[PROP_MAX];\n          } else if (prop === PROP_OPTIMUM) {\n            return (this[PROP_MAX] - this[PROP_MIN]) / 2 + this[PROP_MIN];\n          } else if (prop === PROP_VALUE) {\n            return this[PROP_MIN];\n          }\n          return METER_INITAL_VALUES[prop];\n        }\n\n        return this.getAttribute(prop);\n      };\n    }\n\n    each(METER_PROPS, function(prop) {\n      Object.defineProperty(prototype, prop, {\n        // enumerable: true, // can't do this on ie8\n        // configurable: true\n        set: getSetter(prop),\n        get: getGetter(prop)\n      });\n    });\n\n    // ie 8\n    // var setAttribute = prototype.setAttribute;\n    // console.log(setAttribute);\n    // Object.defineProperty(prototype, 'setAttribute', {\n    //   value: function(prop, value) {\n    //     this[prop] = value;\n    //     if (isMeter(this)) {\n    //       console.log('update');\n    //       updateMeterStyle(this);\n    //     }\n    //   }\n    // });\n  })();\n\n  (function checkReady() {\n\n    function completed() {\n      if (document.readyState === 'complete') {\n        isReady = true;\n      }\n    }\n    completed();\n\n    on(document, 'DOMContentLoaded', function() {\n      isReady = true;\n    });\n\n    on(window, 'load', function() {\n      isReady = true;\n    });\n\n    on(document, 'readystatechange', completed);\n\n    // uglify will break window without a wrapper\n    var isTop = false;\n    try {\n      isTop = window.frameElement === null;\n    } catch (_) {}\n\n    if (!supports.addEventListener && documentElement.doScroll && isTop) {\n      (function doScroll() {\n        try {\n          documentElement.doScroll();\n        } catch (_) {\n          return setTimeout(doScroll, 50);\n        }\n        isReady = true;\n      })();\n    }\n  })();\n\n  (function polyfillWhenReady() {\n    if (isReady) {\n      polyfill();\n      observerSubtree();\n    } else {\n      setTimeout(polyfillWhenReady, 50);\n    }\n  })();\n\n\n  meterPolyfill.polyfill = polyfill;\n\n  return meterPolyfill;\n\n});\n"]}